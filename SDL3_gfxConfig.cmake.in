# SDL3_gfx CMake configuration file

include(FeatureSummary)
set_package_properties(SDL3_gfx PROPERTIES
    URL "https://github.com/ferzkopp/SDL_gfx"
    DESCRIPTION "SDL3_gfx is a graphics primitives library for SDL3"
)

cmake_minimum_required(VERSION 3.0...4.0)

# Copied from `configure_package_config_file`
macro(check_required_components _NAME)
    foreach(comp ${${_NAME}_FIND_COMPONENTS})
        if(NOT ${_NAME}_${comp}_FOUND)
            if(${_NAME}_FIND_REQUIRED_${comp})
                set(${_NAME}_FOUND FALSE)
            endif()
        endif()
    endforeach()
endmacro()

set(SDL3_gfx_FOUND TRUE)

# Check if this is a MSVC-style package (has relative paths to lib/x86, lib/x64, etc.)
# or a normal Unix-style installation
set(_sdl3gfx_is_msvc_package FALSE)
if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/../lib/x64" OR EXISTS "${CMAKE_CURRENT_LIST_DIR}/../lib/x86")
    set(_sdl3gfx_is_msvc_package TRUE)
endif()

if(_sdl3gfx_is_msvc_package)
    # MSVC-style package structure
    if(SDL_CPU_X86)
        set(_sdl_arch_subdir "x86")
    elseif(SDL_CPU_X64 OR SDL_CPU_ARM64EC)
        set(_sdl_arch_subdir "x64")
    elseif(SDL_CPU_ARM64)
        set(_sdl_arch_subdir "arm64")
    else()
        set(SDL3_gfx_FOUND FALSE)
        return()
    endif()

    set(_sdl3gfx_incdir       "${CMAKE_CURRENT_LIST_DIR}/../include")
    set(_sdl3gfx_library      "${CMAKE_CURRENT_LIST_DIR}/../lib/${_sdl_arch_subdir}/SDL3_gfx.lib")
    set(_sdl3gfx_dll          "${CMAKE_CURRENT_LIST_DIR}/../lib/${_sdl_arch_subdir}/SDL3_gfx.dll")

    # All targets are created, even when some might not be requested though COMPONENTS.
    # This is done for compatibility with CMake generated SDL3_gfx-target.cmake files.
    set(SDL3_gfx_SDL3_gfx-shared_FOUND TRUE)
    if(NOT TARGET SDL3_gfx::SDL3_gfx-shared)
        add_library(SDL3_gfx::SDL3_gfx-shared SHARED IMPORTED)
        set_target_properties(SDL3_gfx::SDL3_gfx-shared
            PROPERTIES
                INTERFACE_INCLUDE_DIRECTORIES "${_sdl3gfx_incdir}"
                IMPORTED_IMPLIB "${_sdl3gfx_library}"
                IMPORTED_LOCATION "${_sdl3gfx_dll}"
                COMPATIBLE_INTERFACE_BOOL "SDL3_SHARED"
                INTERFACE_SDL3_SHARED "ON"
        )
    endif()

    unset(_sdl_arch_subdir)
    unset(_sdl3gfx_incdir)
    unset(_sdl3gfx_library)
    unset(_sdl3gfx_dll)

    set(SDL3_gfx_SDL3_gfx-static_FOUND TRUE)

    set(SDL3_gfx_SDL3_gfx_FOUND FALSE)
    if(SDL3_gfx_SDL3_gfx-shared_FOUND OR SDL3_gfx_SDL3_gfx-static_FOUND)
        set(SDL3_gfx_SDL3_gfx_FOUND TRUE)
    endif()

    function(_sdl_create_target_alias_compat NEW_TARGET TARGET)
        if(CMAKE_VERSION VERSION_LESS "3.18")
            # Aliasing local targets is not supported on CMake < 3.18, so make it global.
            add_library(${NEW_TARGET} INTERFACE IMPORTED)
            set_target_properties(${NEW_TARGET} PROPERTIES INTERFACE_LINK_LIBRARIES "${TARGET}")
        else()
            add_library(${NEW_TARGET} ALIAS ${TARGET})
        endif()
    endfunction()

    # Make sure SDL3_gfx::SDL3_gfx always exists
    if(NOT TARGET SDL3_gfx::SDL3_gfx)
        if(TARGET SDL3_gfx::SDL3_gfx-shared)
            _sdl_create_target_alias_compat(SDL3_gfx::SDL3_gfx SDL3_gfx::SDL3_gfx-shared)
        endif()
    endif()
else()
    # Normal installation - use targets file generated by CMake
    include("${CMAKE_CURRENT_LIST_DIR}/SDL3_gfxTargets.cmake")
    
    set(SDL3_gfx_SDL3_gfx_FOUND TRUE)
    if(TARGET SDL3_gfx::SDL3_gfx-shared)
        set(SDL3_gfx_SDL3_gfx-shared_FOUND TRUE)
    endif()
    if(TARGET SDL3_gfx::SDL3_gfx-static)
        set(SDL3_gfx_SDL3_gfx-static_FOUND TRUE)
    endif()

    function(_sdl_create_target_alias_compat NEW_TARGET TARGET)
        if(CMAKE_VERSION VERSION_LESS "3.18")
            # Aliasing local targets is not supported on CMake < 3.18, so make it global.
            add_library(${NEW_TARGET} INTERFACE IMPORTED)
            set_target_properties(${NEW_TARGET} PROPERTIES INTERFACE_LINK_LIBRARIES "${TARGET}")
        else()
            add_library(${NEW_TARGET} ALIAS ${TARGET})
        endif()
    endfunction()

    # Make sure SDL3_gfx::SDL3_gfx always exists
    if(NOT TARGET SDL3_gfx::SDL3_gfx)
        if(TARGET SDL3_gfx::SDL3_gfx-shared)
            _sdl_create_target_alias_compat(SDL3_gfx::SDL3_gfx SDL3_gfx::SDL3_gfx-shared)
        elseif(TARGET SDL3_gfx::SDL3_gfx-static)
            _sdl_create_target_alias_compat(SDL3_gfx::SDL3_gfx SDL3_gfx::SDL3_gfx-static)
        endif()
    endif()
endif()

check_required_components(SDL3_gfx)
